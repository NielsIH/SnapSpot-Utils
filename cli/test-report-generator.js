import {
  generateTextReport,
  generateJsonReport,
  generateHtmlReport,
  writeReportToFile
} from './shared/report-generator.js'
import fs from 'fs/promises'
import path from 'path'

const reportData = {
  title: 'Test Report',
  subtitle: 'Generated by Phase 7A tests',
  summary: {
    totalFiles: 100,
    processed: 95,
    failed: 5,
    duration: '2m 15s'
  },
  detailHeaders: ['Filename', 'Status', 'Size'],
  details: [
    ['file1.json', 'Success', '1.2MB'],
    ['file2.json', 'Success', '2.4MB'],
    ['file3.json', 'Failed', '0KB']
  ],
  footer: 'Test completed successfully'
}

console.log('Testing Report Generator...\n')

try {
  // Test 1: Text report
  console.log('1. Generating text report...')
  const textReport = generateTextReport(reportData)
  console.log(textReport)

  // Test 2: JSON report
  console.log('\n2. Generating JSON report...')
  const jsonReport = generateJsonReport(reportData)
  const parsed = JSON.parse(jsonReport)
  console.log(`  ✓ Valid JSON (${Object.keys(parsed).length} keys)`)

  // Test 3: HTML report
  console.log('\n3. Generating HTML report...')
  const htmlReport = generateHtmlReport(reportData)
  await writeReportToFile(htmlReport, './test-report.html')
  console.log('  ✓ HTML report written to: ./test-report.html')
  console.log('  ℹ Open this file in a browser to verify')

  console.log('\n✓ Report Generator tests complete')
  console.log('\nNOTE: Open test-report.html in a browser to verify rendering')
} catch (err) {
  console.error(`✗ Error: ${err.message}`)
}
